<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Automotive Protocols OSI Layer Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .protocol-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 0 50px;
        }

        .protocol-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .protocol-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .protocol-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .protocol-btn.can {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .protocol-btn.canfd {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .protocol-btn.canxl {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
        }

        .protocol-btn.flexray {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .protocol-btn.lin {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
        }

        .protocol-btn.ethernet {
            background: linear-gradient(135deg, #FF8C42, #FF4E50);
        }

        .protocol-btn.ethernet10 {
            background: linear-gradient(135deg, #A8E6CF, #7FFF00);
        }

        .protocol-btn.most {
            background: linear-gradient(135deg, #DDA0DD, #9370DB);
        }

        .protocol-btn.active {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .protocol-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .category-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .category-protocols {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .protocol-badge {
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.85em;
            color: white;
            background: #7f8c8d;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .protocol-info {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .protocol-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .spec-label {
            color: #7f8c8d;
            font-weight: 500;
        }

        .spec-value {
            color: #2c3e50;
            font-weight: bold;
            text-align: right;
            max-width: 60%;
        }

        .layer-stack {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .layer-stack h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .layer {
            margin: 8px 0;
            padding: 12px;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .layer.active {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .layer.not-used {
            opacity: 0.3;
            background: #ecf0f1 !important;
        }

        .layer-7 { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .layer-6 { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
        .layer-5 { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
        .layer-4 { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; }
        .layer-3 { background: linear-gradient(135deg, #fa709a, #fee140); color: white; }
        .layer-2 { background: linear-gradient(135deg, #30cfd0, #330867); color: white; }
        .layer-1 { background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333; }

        .layer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .layer-number {
            display: inline-block;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            text-align: center;
            line-height: 25px;
            margin-right: 10px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .layer-name {
            font-weight: bold;
            flex-grow: 1;
        }

        .layer-protocol {
            font-size: 0.85em;
            opacity: 0.9;
            text-align: right;
            max-width: 200px;
        }

        .message-flow {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .message-flow h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .flow-visualization {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            min-height: 150px;
            border: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .bit-stream {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .bit {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }

        .bit.dominant {
            background: #27ae60;
            color: white;
        }

        .bit.recessive {
            background: #e74c3c;
            color: white;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .controls h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #7f8c8d;
            font-weight: 500;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            margin-right: 10px;
        }

        .btn-send {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .btn-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .comparison-table {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .comparison-table h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }

        th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .feature-yes {
            color: #27ae60;
            font-weight: bold;
        }

        .feature-no {
            color: #e74c3c;
            font-weight: bold;
        }

        .feature-partial {
            color: #f39c12;
            font-weight: bold;
        }

        .timing-diagram {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .timing-diagram h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .signal-line {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .signal-label {
            width: 120px;
            font-weight: bold;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .signal-wave {
            flex-grow: 1;
            height: 40px;
            background: #f8f9fa;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .signal-pulse {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            animation: pulse-move 3s linear infinite;
        }

        @keyframes pulse-move {
            from { left: -100px; }
            to { left: 100%; }
        }

        .ecu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .ecu-node {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .ecu-node:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .ecu-node.active {
            animation: ecu-pulse 1s ease-in-out;
        }

        @keyframes ecu-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .network-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            margin-left: 5px;
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚗 Complete Automotive Protocols OSI Layer Simulator</h1>
        <p class="subtitle">Explore how all automotive protocols (CAN, Ethernet, FlexRay, MOST, LIN) map to the OSI model</p>
        
        <div class="protocol-categories">
            <div class="category-card">
                <div class="category-title">🚌 Traditional Bus</div>
                <div class="category-protocols">
                    <span class="protocol-badge">CAN</span>
                    <span class="protocol-badge">CAN-FD</span>
                    <span class="protocol-badge">CAN-XL</span>
                    <span class="protocol-badge">LIN</span>
                </div>
            </div>
            <div class="category-card">
                <div class="category-title">🌐 Ethernet-Based</div>
                <div class="category-protocols">
                    <span class="protocol-badge">100BASE-T1</span>
                    <span class="protocol-badge">1000BASE-T1</span>
                    <span class="protocol-badge">10BASE-T1S</span>
                </div>
            </div>
            <div class="category-card">
                <div class="category-title">⚡ High-Speed/Specialized</div>
                <div class="category-protocols">
                    <span class="protocol-badge">FlexRay</span>
                    <span class="protocol-badge">MOST</span>
                </div>
            </div>
        </div>
        
        <div class="protocol-selector">
            <button class="protocol-btn can active" onclick="selectProtocol('CAN')">CAN</button>
            <button class="protocol-btn canfd" onclick="selectProtocol('CAN-FD')">CAN-FD</button>
            <button class="protocol-btn canxl" onclick="selectProtocol('CAN-XL')">CAN-XL</button>
            <button class="protocol-btn flexray" onclick="selectProtocol('FlexRay')">FlexRay</button>
            <button class="protocol-btn lin" onclick="selectProtocol('LIN')">LIN</button>
            <button class="protocol-btn ethernet" onclick="selectProtocol('Ethernet')">Auto Ethernet</button>
            <button class="protocol-btn ethernet10" onclick="selectProtocol('10BASE-T1S')">10BASE-T1S</button>
            <button class="protocol-btn most" onclick="selectProtocol('MOST')">MOST</button>
        </div>

        <div class="controls">
            <h3>📡 Message Configuration</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label for="ecu-source">Source ECU:</label>
                    <select id="ecu-source">
                        <option value="ADAS">ADAS Controller</option>
                        <option value="Gateway">Central Gateway</option>
                        <option value="Engine">Engine Control</option>
                        <option value="Infotainment">Infotainment</option>
                        <option value="Camera">Camera Module</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="message-type">Message Type:</label>
                    <select id="message-type">
                        <option value="data">Data Frame</option>
                        <option value="diagnostic">Diagnostic (UDS)</option>
                        <option value="doip">DoIP (Ethernet)</option>
                        <option value="someip">SOME/IP</option>
                        <option value="avb">AVB Stream</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="priority">Priority/VLAN:</label>
                    <select id="priority">
                        <option value="high">High Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="low">Low Priority</option>
                        <option value="tsn">TSN Critical</option>
                    </select>
                </div>
            </div>
            <button class="btn-send" onclick="transmitMessage()">Transmit Message</button>
            <button class="btn-send" style="background: linear-gradient(135deg, #f093fb, #f5576c);" onclick="startDiagnostic()">Send Diagnostic</button>
            <button class="btn-send" style="background: linear-gradient(135deg, #43e97b, #38f9d7);" onclick="simulateGateway()">Gateway Routing</button>
        </div>

        <div class="main-content">
            <div class="protocol-info">
                <h3 id="protocol-title">CAN Protocol</h3>
                <div class="spec-item">
                    <span class="spec-label">Speed:</span>
                    <span class="spec-value" id="speed">1 Mbps</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Max Data:</span>
                    <span class="spec-value" id="max-data">8 bytes</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Latency:</span>
                    <span class="spec-value" id="latency">< 1ms</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Topology:</span>
                    <span class="spec-value" id="topology">Bus</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Access:</span>
                    <span class="spec-value" id="access">CSMA/CA</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Error Detection:</span>
                    <span class="spec-value" id="error-detect">CRC-15</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Applications:</span>
                    <span class="spec-value" id="applications">Powertrain, Body</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Standard:</span>
                    <span class="spec-value" id="standard">ISO 11898</span>
                </div>
            </div>

            <div class="layer-stack">
                <h2>OSI Layer Mapping</h2>
                <div class="layer layer-7" id="layer-7" onclick="showLayerDetails(7)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">7</span>
                            <span class="layer-name">Application</span>
                        </div>
                        <span class="layer-protocol" id="layer-7-protocol">UDS, OBD-II</span>
                    </div>
                </div>
                <div class="layer layer-6" id="layer-6" onclick="showLayerDetails(6)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">6</span>
                            <span class="layer-name">Presentation</span>
                        </div>
                        <span class="layer-protocol" id="layer-6-protocol">Data Encoding</span>
                    </div>
                </div>
                <div class="layer layer-5" id="layer-5" onclick="showLayerDetails(5)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">5</span>
                            <span class="layer-name">Session</span>
                        </div>
                        <span class="layer-protocol" id="layer-5-protocol">Diagnostic Sessions</span>
                    </div>
                </div>
                <div class="layer layer-4" id="layer-4" onclick="showLayerDetails(4)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">4</span>
                            <span class="layer-name">Transport</span>
                        </div>
                        <span class="layer-protocol" id="layer-4-protocol">ISO-TP</span>
                    </div>
                </div>
                <div class="layer layer-3" id="layer-3" onclick="showLayerDetails(3)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">3</span>
                            <span class="layer-name">Network</span>
                        </div>
                        <span class="layer-protocol" id="layer-3-protocol">Limited/Gateway</span>
                    </div>
                </div>
                <div class="layer layer-2" id="layer-2" onclick="showLayerDetails(2)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">2</span>
                            <span class="layer-name">Data Link</span>
                        </div>
                        <span class="layer-protocol" id="layer-2-protocol">CAN Protocol</span>
                    </div>
                </div>
                <div class="layer layer-1" id="layer-1" onclick="showLayerDetails(1)">
                    <div class="layer-content">
                        <div>
                            <span class="layer-number">1</span>
                            <span class="layer-name">Physical</span>
                        </div>
                        <span class="layer-protocol" id="layer-1-protocol">CAN_H/CAN_L</span>
                    </div>
                </div>
            </div>

            <div>
                <div class="protocol-info" style="margin-bottom: 20px;">
                    <h3>ECU Network</h3>
                    <div class="ecu-grid">
                        <div class="ecu-node" id="ecu-adas">ADAS<span class="network-type-badge">ETH</span></div>
                        <div class="ecu-node" id="ecu-gateway">Gateway<span class="network-type-badge">ALL</span></div>
                        <div class="ecu-node" id="ecu-engine">Engine<span class="network-type-badge">CAN</span></div>
                        <div class="ecu-node" id="ecu-infotainment">Infotainment<span class="network-type-badge">MOST</span></div>
                        <div class="ecu-node" id="ecu-camera">Camera<span class="network-type-badge">ETH</span></div>
                        <div class="ecu-node" id="ecu-radar">Radar<span class="network-type-badge">CAN</span></div>
                        <div class="ecu-node" id="ecu-body">Body<span class="network-type-badge">LIN</span></div>
                        <div class="ecu-node" id="ecu-tcu">TCU<span class="network-type-badge">ETH</span></div>
                    </div>
                </div>
                
                <div class="protocol-info">
                    <h3>Frame/Packet Structure</h3>
                    <div id="frame-structure" style="font-family: monospace; font-size: 0.85em; padding: 10px; background: #f8f9fa; border-radius: 5px; overflow-x: auto;">
                        <!-- Frame structure will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="message-flow">
            <h3>📊 Message Flow Visualization</h3>
            <div class="flow-visualization" id="flow-viz">
                Select a protocol and transmit a message to see the data flow...
            </div>
            <div class="bit-stream" id="bit-stream">
                <!-- Bit visualization will appear here -->
            </div>
        </div>

        <div class="timing-diagram">
            <h3>📈 Physical Layer Signals</h3>
            <div id="signal-container">
                <!-- Dynamic signal lines will be added here -->
            </div>
        </div>

        <div class="comparison-table">
            <h3>🔄 Complete Protocol Comparison</h3>
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>CAN</th>
                        <th>CAN-FD</th>
                        <th>CAN-XL</th>
                        <th>FlexRay</th>
                        <th>LIN</th>
                        <th>Auto Ethernet</th>
                        <th>10BASE-T1S</th>
                        <th>MOST</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Max Speed</td>
                        <td>1 Mbps</td>
                        <td>8 Mbps</td>
                        <td>20 Mbps</td>
                        <td>10 Mbps</td>
                        <td>20 kbps</td>
                        <td>1 Gbps</td>
                        <td>10 Mbps</td>
                        <td>150 Mbps</td>
                    </tr>
                    <tr>
                        <td>Max Data</td>
                        <td>8 bytes</td>
                        <td>64 bytes</td>
                        <td>2048 bytes</td>
                        <td>254 bytes</td>
                        <td>8 bytes</td>
                        <td>1500 bytes</td>
                        <td>1500 bytes</td>
                        <td>Streaming</td>
                    </tr>
                    <tr>
                        <td>Topology</td>
                        <td>Bus</td>
                        <td>Bus</td>
                        <td>Bus</td>
                        <td>Bus/Star</td>
                        <td>Bus</td>
                        <td>Point-to-Point</td>
                        <td>Multi-drop</td>
                        <td>Ring</td>
                    </tr>
                    <tr>
                        <td>Deterministic</td>
                        <td class="feature-no">No</td>
                        <td class="feature-no">No</td>
                        <td class="feature-partial">Improved</td>
                        <td class="feature-yes">Yes</td>
                        <td class="feature-partial">Schedule</td>
                        <td class="feature-yes">TSN</td>
                        <td class="feature-partial">PLCA</td>
                        <td class="feature-yes">Yes</td>
                    </tr>
                    <tr>
                        <td>Power over Data</td>
                        <td class="feature-no">No</td>
                        <td class="feature-no">No</td>
                        <td class="feature-no">No</td>
                        <td class="feature-no">No</td>
                        <td class="feature-yes">Yes</td>
                        <td class="feature-yes">PoDL</td>
                        <td class="feature-yes">PoDL</td>
                        <td class="feature-no">No</td>
                    </tr>
                    <tr>
                        <td>Cost</td>
                        <td class="feature-yes">Low</td>
                        <td class="feature-yes">Low-Med</td>
                        <td class="feature-partial">Medium</td>
                        <td class="feature-no">High</td>
                        <td class="feature-yes">Very Low</td>
                        <td class="feature-no">High</td>
                        <td class="feature-partial">Medium</td>
                        <td class="feature-no">High</td>
                    </tr>
                    <tr>
                        <td>Typical Use</td>
                        <td>Powertrain</td>
                        <td>ADAS</td>
                        <td>Backbone</td>
                        <td>Safety</td>
                        <td>Body</td>
                        <td>Backbone, ADAS</td>
                        <td>Zonal Arch</td>
                        <td>Infotainment</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentProtocol = 'CAN';
        let transmissionActive = false;

        const protocolSpecs = {
            'CAN': {
                title: 'CAN Protocol',
                speed: '1 Mbps',
                maxData: '8 bytes',
                latency: '< 1ms',
                topology: 'Bus',
                access: 'CSMA/CA',
                errorDetect: 'CRC-15',
                applications: 'Powertrain, Body',
                standard: 'ISO 11898',
                layers: {
                    7: { used: true, protocol: 'UDS, OBD-II, J1939' },
                    6: { used: true, protocol: 'Data Encoding' },
                    5: { used: true, protocol: 'Diagnostic Sessions' },
                    4: { used: true, protocol: 'ISO-TP (ISO 15765-2)' },
                    3: { used: false, protocol: 'Limited/Gateway only' },
                    2: { used: true, protocol: 'CAN 2.0A/B Protocol' },
                    1: { used: true, protocol: 'CAN_H/CAN_L Differential' }
                }
            },
            'CAN-FD': {
                title: 'CAN-FD Protocol',
                speed: '8 Mbps (data)',
                maxData: '64 bytes',
                latency: '< 1ms',
                topology: 'Bus',
                access: 'CSMA/CA + BRS',
                errorDetect: 'CRC-17/21',
                applications: 'ADAS, Infotainment',
                standard: 'ISO 11898-1:2015',
                layers: {
                    7: { used: true, protocol: 'UDS, DoIP, SOME/IP' },
                    6: { used: true, protocol: 'Enhanced Encoding' },
                    5: { used: true, protocol: 'Extended Sessions' },
                    4: { used: true, protocol: 'ISO-TP with FD support' },
                    3: { used: false, protocol: 'Gateway functions' },
                    2: { used: true, protocol: 'CAN-FD Protocol' },
                    1: { used: true, protocol: 'CAN_H/CAN_L with BRS' }
                }
            },
            'CAN-XL': {
                title: 'CAN-XL Protocol',
                speed: '20 Mbps',
                maxData: '2048 bytes',
                latency: '< 2ms',
                topology: 'Bus',
                access: 'CSMA/CA Enhanced',
                errorDetect: 'CRC-32',
                applications: 'Backbone, Zonal Architecture',
                standard: 'CiA 610/611',
                layers: {
                    7: { used: true, protocol: 'Service-Oriented Comm' },
                    6: { used: true, protocol: 'SDU Type Field' },
                    5: { used: true, protocol: 'Enhanced Sessions' },
                    4: { used: true, protocol: 'Built-in Segmentation' },
                    3: { used: true, protocol: 'VLAN-like Priority' },
                    2: { used: true, protocol: 'CAN-XL Data Link' },
                    1: { used: true, protocol: 'SIC/XL Transceiver' }
                }
            },
            'FlexRay': {
                title: 'FlexRay Protocol',
                speed: '10 Mbps',
                maxData: '254 bytes',
                latency: 'Deterministic',
                topology: 'Bus/Star/Hybrid',
                access: 'TDMA',
                errorDetect: 'CRC-24',
                applications: 'X-by-Wire, Safety',
                standard: 'ISO 17458',
                layers: {
                    7: { used: true, protocol: 'FIBEX, AUTOSAR' },
                    6: { used: true, protocol: 'Signal Mapping' },
                    5: { used: false, protocol: 'Not typically used' },
                    4: { used: true, protocol: 'FlexRay TP' },
                    3: { used: false, protocol: 'Not used' },
                    2: { used: true, protocol: 'FlexRay Protocol (Dual)' },
                    1: { used: true, protocol: 'BP/BM Differential' }
                }
            },
            'LIN': {
                title: 'LIN Protocol',
                speed: '20 kbps',
                maxData: '8 bytes',
                latency: '< 10ms',
                topology: 'Bus (Master-Slave)',
                access: 'Master-controlled',
                errorDetect: 'Checksum',
                applications: 'Door, Seat, Mirror',
                standard: 'ISO 17987',
                layers: {
                    7: { used: true, protocol: 'LIN Diagnostics' },
                    6: { used: false, protocol: 'Not used' },
                    5: { used: false, protocol: 'Not used' },
                    4: { used: false, protocol: 'Not used' },
                    3: { used: false, protocol: 'Not used' },
                    2: { used: true, protocol: 'LIN 2.2 Protocol' },
                    1: { used: true, protocol: 'Single Wire UART' }
                }
            },
            'Ethernet': {
                title: 'Automotive Ethernet',
                speed: '100M/1G/10G bps',
                maxData: '1500 bytes (Jumbo: 9000)',
                latency: 'TSN: < 100μs',
                topology: 'Point-to-Point/Switch',
                access: 'CSMA/CD (Full-Duplex)',
                errorDetect: 'CRC-32',
                applications: 'Backbone, ADAS, Infotainment',
                standard: 'IEEE 802.3/802.1',
                layers: {
                    7: { used: true, protocol: 'SOME/IP, DoIP, AVB/TSN' },
                    6: { used: true, protocol: 'Serialization, RPC' },
                    5: { used: true, protocol: 'Socket APIs' },
                    4: { used: true, protocol: 'TCP/UDP' },
                    3: { used: true, protocol: 'IPv4/IPv6, VLAN' },
                    2: { used: true, protocol: 'Ethernet MAC, TSN' },
                    1: { used: true, protocol: '100/1000BASE-T1' }
                }
            },
            '10BASE-T1S': {
                title: '10BASE-T1S Ethernet',
                speed: '10 Mbps',
                maxData: '1500 bytes',
                latency: 'PLCA: Deterministic',
                topology: 'Multi-drop Bus',
                access: 'PLCA (PHY-Level Collision Avoidance)',
                errorDetect: 'CRC-32',
                applications: 'Zonal Architecture, Sensors',
                standard: 'IEEE 802.3cg',
                layers: {
                    7: { used: true, protocol: 'Lightweight Services' },
                    6: { used: true, protocol: 'Data Serialization' },
                    5: { used: true, protocol: 'Session Management' },
                    4: { used: true, protocol: 'UDP (mainly)' },
                    3: { used: true, protocol: 'IPv6/IPv4' },
                    2: { used: true, protocol: 'Ethernet with PLCA' },
                    1: { used: true, protocol: 'Single Pair, Multi-drop' }
                }
            },
            'MOST': {
                title: 'MOST (Media Oriented Systems Transport)',
                speed: '25/50/150 Mbps',
                maxData: 'Streaming + Control',
                latency: 'Isochronous',
                topology: 'Ring',
                access: 'TDMA',
                errorDetect: 'CRC + FEC',
                applications: 'Infotainment, Audio/Video',
                standard: 'MOST Cooperation',
                layers: {
                    7: { used: true, protocol: 'MOST High Protocol' },
                    6: { used: true, protocol: 'Audio/Video Codecs' },
                    5: { used: true, protocol: 'Connection Management' },
                    4: { used: true, protocol: 'Streaming Channels' },
                    3: { used: true, protocol: 'MOST Network Services' },
                    2: { used: true, protocol: 'MOST Data Link' },
                    1: { used: true, protocol: 'Optical/Electrical Ring' }
                }
            }
        };

        function selectProtocol(protocol) {
            currentProtocol = protocol;
            
            // Update button states
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Find and activate the correct button
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                if (btn.textContent === protocol || 
                    btn.textContent === protocol.replace('-', '') ||
                    (protocol === 'Ethernet' && btn.textContent === 'Auto Ethernet') ||
                    (protocol === '10BASE-T1S' && btn.textContent === '10BASE-T1S')) {
                    btn.classList.add('active');
                }
            });
            
            // Update protocol info
            const specs = protocolSpecs[protocol];
            document.getElementById('protocol-title').textContent = specs.title;
            document.getElementById('speed').textContent = specs.speed;
            document.getElementById('max-data').textContent = specs.maxData;
            document.getElementById('latency').textContent = specs.latency;
            document.getElementById('topology').textContent = specs.topology;
            document.getElementById('access').textContent = specs.access;
            document.getElementById('error-detect').textContent = specs.errorDetect;
            document.getElementById('applications').textContent = specs.applications;
            document.getElementById('standard').textContent = specs.standard;
            
            // Update OSI layers
            for (let i = 1; i <= 7; i++) {
                const layer = document.getElementById(`layer-${i}`);
                const layerProtocol = document.getElementById(`layer-${i}-protocol`);
                
                if (specs.layers[i].used) {
                    layer.classList.remove('not-used');
                    layerProtocol.textContent = specs.layers[i].protocol;
                } else {
                    layer.classList.add('not-used');
                    layerProtocol.textContent = specs.layers[i].protocol;
                }
            }
            
            // Update signal display
            updateSignalDisplay(protocol);
            
            // Update frame structure
            updateFrameStructure(protocol);
        }

        function updateSignalDisplay(protocol) {
            const container = document.getElementById('signal-container');
            container.innerHTML = '';
            
            let signals = [];
            
            switch(protocol) {
                case 'CAN':
                case 'CAN-FD':
                case 'CAN-XL':
                    signals = [
                        { label: 'CAN_H:', color: '#3498db' },
                        { label: 'CAN_L:', color: '#e74c3c' },
                        { label: 'Differential:', color: '#2ecc71' }
                    ];
                    break;
                case 'FlexRay':
                    signals = [
                        { label: 'BP (Ch A):', color: '#3498db' },
                        { label: 'BM (Ch A):', color: '#e74c3c' },
                        { label: 'BP (Ch B):', color: '#9b59b6' },
                        { label: 'BM (Ch B):', color: '#f39c12' }
                    ];
                    break;
                case 'LIN':
                    signals = [
                        { label: 'LIN Bus:', color: '#3498db' },
                        { label: 'Ground:', color: '#95a5a6' }
                    ];
                    break;
                case 'Ethernet':
                case '10BASE-T1S':
                    signals = [
                        { label: 'MDI+:', color: '#3498db' },
                        { label: 'MDI-:', color: '#e74c3c' },
                        { label: 'PAM3/MLT3:', color: '#2ecc71' }
                    ];
                    break;
                case 'MOST':
                    signals = [
                        { label: 'Optical TX:', color: '#e74c3c' },
                        { label: 'Optical RX:', color: '#3498db' },
                        { label: 'Control Channel:', color: '#2ecc71' },
                        { label: 'Streaming:', color: '#f39c12' }
                    ];
                    break;
            }
            
            signals.forEach((signal, index) => {
                const signalLine = document.createElement('div');
                signalLine.className = 'signal-line';
                signalLine.innerHTML = `
                    <span class="signal-label">${signal.label}</span>
                    <div class="signal-wave">
                        <div class="signal-pulse" style="width: ${50 + index * 10}px; background: ${signal.color}; animation-delay: ${index * 0.3}s;"></div>
                    </div>
                `;
                container.appendChild(signalLine);
            });
        }

        function updateFrameStructure(protocol) {
            const frameDiv = document.getElementById('frame-structure');
            
            const structures = {
                'CAN': `
                    <div style="color: #27ae60;">SOF (1)</div>
                    <div style="color: #3498db;">ID (11/29)</div>
                    <div style="color: #9b59b6;">RTR (1) | IDE (1) | r0 (1)</div>
                    <div style="color: #e74c3c;">DLC (4)</div>
                    <div style="color: #f39c12;">DATA (0-64)</div>
                    <div style="color: #1abc9c;">CRC (15)</div>
                    <div style="color: #34495e;">ACK (2) | EOF (7)</div>
                `,
                'CAN-FD': `
                    <div style="color: #27ae60;">SOF (1)</div>
                    <div style="color: #3498db;">ID (11/29)</div>
                    <div style="color: #9b59b6;">FDF (1) | BRS (1) | ESI (1)</div>
                    <div style="color: #e74c3c;">DLC (4)</div>
                    <div style="color: #f39c12;">DATA (0-512)</div>
                    <div style="color: #1abc9c;">Stuff Count + CRC (17/21)</div>
                    <div style="color: #34495e;">ACK (2) | EOF (7)</div>
                `,
                'CAN-XL': `
                    <div style="color: #27ae60;">SOF (1)</div>
                    <div style="color: #3498db;">Priority ID (11)</div>
                    <div style="color: #8e44ad;">SDU Type (8)</div>
                    <div style="color: #d35400;">VCID (8)</div>
                    <div style="color: #e74c3c;">DLC (11)</div>
                    <div style="color: #f39c12;">DATA (1-2048 bytes)</div>
                    <div style="color: #1abc9c;">CRC-32</div>
                    <div style="color: #34495e;">ACK | EOF</div>
                `,
                'FlexRay': `
                    <div style="color: #27ae60;">TSS (1)</div>
                    <div style="color: #3498db;">FSS (1) | Reserved (1)</div>
                    <div style="color: #9b59b6;">Frame ID (11)</div>
                    <div style="color: #e74c3c;">Payload Length (7)</div>
                    <div style="color: #f39c12;">Header CRC (11)</div>
                    <div style="color: #16a085;">Cycle Count (6)</div>
                    <div style="color: #d35400;">DATA (0-254 bytes)</div>
                    <div style="color: #8e44ad;">CRC (24)</div>
                `,
                'LIN': `
                    <div style="color: #27ae60;">Break (13 bits)</div>
                    <div style="color: #3498db;">Sync (0x55)</div>
                    <div style="color: #9b59b6;">ID (6 bits + 2 parity)</div>
                    <div style="color: #f39c12;">DATA (0-8 bytes)</div>
                    <div style="color: #1abc9c;">Checksum (8 bits)</div>
                `,
                'Ethernet': `
                    <div style="color: #27ae60;">Preamble (7)</div>
                    <div style="color: #3498db;">SFD (1)</div>
                    <div style="color: #9b59b6;">Dest MAC (6)</div>
                    <div style="color: #e67e22;">Src MAC (6)</div>
                    <div style="color: #8e44ad;">VLAN Tag (4 optional)</div>
                    <div style="color: #e74c3c;">Type/Length (2)</div>
                    <div style="color: #f39c12;">Payload (46-1500)</div>
                    <div style="color: #1abc9c;">FCS/CRC-32 (4)</div>
                `,
                '10BASE-T1S': `
                    <div style="color: #27ae60;">PLCA Beacon</div>
                    <div style="color: #3498db;">Preamble (7)</div>
                    <div style="color: #9b59b6;">SFD (1)</div>
                    <div style="color: #e74c3c;">MAC Header (14)</div>
                    <div style="color: #f39c12;">Payload (46-1500)</div>
                    <div style="color: #1abc9c;">FCS (4)</div>
                    <div style="color: #95a5a6;">PLCA Transmit Opportunity</div>
                `,
                'MOST': `
                    <div style="color: #27ae60;">Preamble</div>
                    <div style="color: #3498db;">Boundary Descriptor</div>
                    <div style="color: #9b59b6;">Admin Data (2 bytes)</div>
                    <div style="color: #e74c3c;">Sync Channel (60 bytes)</div>
                    <div style="color: #f39c12;">Async Channel (variable)</div>
                    <div style="color: #16a085;">Control Channel (2 bytes)</div>
                    <div style="color: #8e44ad;">Status</div>
                `
            };
            
            frameDiv.innerHTML = structures[protocol] || '<div>Frame structure not defined</div>';
        }

        function transmitMessage() {
            if (transmissionActive) return;
            
            transmissionActive = true;
            const source = document.getElementById('ecu-source').value;
            const messageType = document.getElementById('message-type').value;
            const priority = document.getElementById('priority').value;
            
            // Animate source ECU
            const sourceEcu = document.getElementById(`ecu-${source.toLowerCase()}`);
            if (sourceEcu) {
                sourceEcu.classList.add('active');
            }
            
            // Simulate layer processing
            const specs = protocolSpecs[currentProtocol];
            let currentLayer = 7;
            
            const processLayer = () => {
                if (currentLayer < 1) {
                    transmissionActive = false;
                    if (sourceEcu) {
                        sourceEcu.classList.remove('active');
                    }
                    showCompletionMessage();
                    return;
                }
                
                const layerEl = document.getElementById(`layer-${currentLayer}`);
                
                if (specs.layers[currentLayer].used) {
                    layerEl.classList.add('active');
                    
                    // Update flow visualization
                    updateFlowVisualization(currentLayer, messageType, priority);
                    
                    setTimeout(() => {
                        layerEl.classList.remove('active');
                        currentLayer--;
                        processLayer();
                    }, 600);
                } else {
                    currentLayer--;
                    processLayer();
                }
            };
            
            processLayer();
        }

        function updateFlowVisualization(layer, messageType, priority) {
            const flowDiv = document.getElementById('flow-viz');
            let content = '';
            
            const layerDescriptions = {
                7: `<strong>Application Layer:</strong> ${messageType.toUpperCase()} message initiated<br>`,
                6: `<strong>Presentation Layer:</strong> Data serialization and encoding<br>`,
                5: `<strong>Session Layer:</strong> Session established, ID: 0x${Math.floor(Math.random() * 65535).toString(16)}<br>`,
                4: `<strong>Transport Layer:</strong> ${currentProtocol.includes('Ethernet') ? 'TCP/UDP' : 'Segmentation'}<br>`,
                3: `<strong>Network Layer:</strong> ${currentProtocol.includes('Ethernet') ? 'IP Routing' : 'Address Resolution'}<br>`,
                2: `<strong>Data Link Layer:</strong> Frame assembly, Priority: ${priority}<br>`,
                1: `<strong>Physical Layer:</strong> Transmitting electrical/optical signals<br>`
            };
            
            content = layerDescriptions[layer] || '';
            
            if (currentProtocol.includes('Ethernet')) {
                content += `Protocol Stack: Ethernet/${messageType === 'doip' ? 'DoIP' : messageType === 'someip' ? 'SOME/IP' : 'TCP/IP'}`;
            } else if (currentProtocol === 'MOST') {
                content += `Channel: ${messageType === 'avb' ? 'Streaming' : 'Control'}`;
            }
            
            flowDiv.innerHTML = content;
        }

        function showCompletionMessage() {
            const flowDiv = document.getElementById('flow-viz');
            flowDiv.innerHTML = `
                <div style="color: #27ae60; font-weight: bold;">✓ Transmission Complete!</div>
                <div>Protocol: ${currentProtocol}</div>
                <div>Layers Used: ${Object.values(protocolSpecs[currentProtocol].layers).filter(l => l.used).length} of 7</div>
                <div>Speed: ${protocolSpecs[currentProtocol].speed}</div>
            `;
        }

        function startDiagnostic() {
            const flowViz = document.getElementById('flow-viz');
            
            if (currentProtocol.includes('Ethernet')) {
                flowViz.innerHTML = `
                    <div style="color: #27ae60; font-weight: bold;">DoIP Diagnostic Request</div>
                    <div>Service: UDS over IP</div>
                    <div>Target: 192.168.1.100:13400</div>
                    <div style="margin-top: 10px;">TCP/IP Stack:</div>
                    <div>L7: DoIP Header + UDS (0x22 Read Data)</div>
                    <div>L4: TCP Port 13400</div>
                    <div>L3: IPv4 Routing</div>
                    <div>L2: Ethernet Frame with VLAN Priority</div>
                `;
            } else {
                flowViz.innerHTML = `
                    <div style="color: #27ae60; font-weight: bold;">Classic Diagnostic Request (UDS)</div>
                    <div>Service: 0x22 (Read Data By Identifier)</div>
                    <div>DID: 0xF190 (VIN)</div>
                    <div style="margin-top: 10px;">Response:</div>
                    <div>0x62 F1 90 [VIN Data]</div>
                `;
            }
            
            // Animate diagnostic layers
            [7, 6, 5, 4].forEach((layer, index) => {
                if (protocolSpecs[currentProtocol].layers[layer].used) {
                    setTimeout(() => {
                        const layerEl = document.getElementById(`layer-${layer}`);
                        layerEl.classList.add('active');
                        setTimeout(() => layerEl.classList.remove('active'), 500);
                    }, index * 200);
                }
            });
        }

        function simulateGateway() {
            const flowViz = document.getElementById('flow-viz');
            flowViz.innerHTML = `
                <div style="color: #f39c12; font-weight: bold;">Gateway Routing Simulation</div>
                <div>Source: CAN Network (500 kbps)</div>
                <div>Destination: Ethernet Network (100 Mbps)</div>
                <div style="margin-top: 10px;">Protocol Translation:</div>
                <div>CAN Frame → Gateway Buffer → IP Packet</div>
                <div>Adding Ethernet/IP headers...</div>
                <div>Routing to target subnet...</div>
            `;
            
            // Animate gateway ECU
            const gatewayEcu = document.getElementById('ecu-gateway');
            if (gatewayEcu) {
                gatewayEcu.classList.add('active');
                setTimeout(() => gatewayEcu.classList.remove('active'), 2000);
            }
        }

        function showLayerDetails(layer) {
            const specs = protocolSpecs[currentProtocol];
            if (!specs.layers[layer].used) {
                alert(`Layer ${layer} is not actively used in ${currentProtocol} protocol`);
                return;
            }
            
            const layerNames = {
                7: 'Application Layer',
                6: 'Presentation Layer',
                5: 'Session Layer',
                4: 'Transport Layer',
                3: 'Network Layer',
                2: 'Data Link Layer',
                1: 'Physical Layer'
            };
            
            alert(`${layerNames[layer]} in ${currentProtocol}:\n\n${specs.layers[layer].protocol}\n\nClick OK to continue`);
        }

        // Initialize with CAN
        selectProtocol('CAN');
    </script>
</body>
</html>
